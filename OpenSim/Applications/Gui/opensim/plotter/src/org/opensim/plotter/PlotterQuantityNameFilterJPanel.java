/*
 * PlotterQuantityNameFilterJPanel.java Filtering dialog for Quantity name  invoked by Plotter
 *
 * Created on April 30, 2007, 1:14 PM
 */

package org.opensim.plotter;

import java.util.regex.PatternSyntaxException;
import javax.swing.event.TableModelEvent;
import javax.swing.event.TableModelListener;

/**
 *
 * @author  Ayman
 */
public class PlotterQuantityNameFilterJPanel extends javax.swing.JPanel 
                                            implements TableModelListener
{
   
   PlotterQuantityNameFilterTableModel tableModel;
   /**
    * Creates new form PlotterQuantityNameFilterJPanel
    */
   public PlotterQuantityNameFilterJPanel(PlotterSourceInterface src) {
      initComponents();
      jFilename.setText(src.getDisplayName());
      tableModel = new PlotterQuantityNameFilterTableModel(src);
      jTable1.setModel(tableModel);
      tableModel.addTableModelListener(this);
   }
   
   /** This method is called from within the constructor to
    * initialize the form.
    * WARNING: Do NOT modify this code. The content of this method is
    * always regenerated by the Form Editor.
    */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jFilenameLabel = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTable1 = new javax.swing.JTable();

        jApplyFilterButton = new javax.swing.JButton();
        jNumSelectedLabel = new javax.swing.JLabel();
        jFilename = new javax.swing.JLabel();
        FilterTextField = new javax.swing.JFormattedTextField();

        jLabel1.setText("Filter By:");

        jLabel2.setText("Source:");

        jFilenameLabel.setText("File:");

        jTable1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null},
                {null, null},
                {null, null}
            },
            new String [] {
                "Title 1", "Title 2"
            }
        ));
        jTable1.setAutoResizeMode(javax.swing.JTable.AUTO_RESIZE_LAST_COLUMN);
        jScrollPane1.setViewportView(jTable1);

        jApplyFilterButton.setText("Apply");
        jApplyFilterButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jApplyFilterButtonActionPerformed(evt);
            }
        });

        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layout.createSequentialGroup()
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                        .add(layout.createSequentialGroup()
                            .addContainerGap()
                            .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 314, Short.MAX_VALUE))
                        .add(org.jdesktop.layout.GroupLayout.LEADING, layout.createSequentialGroup()
                            .addContainerGap()
                            .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                .add(jLabel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 59, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .add(jLabel2))
                            .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                            .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                                .add(layout.createSequentialGroup()
                                    .add(jFilenameLabel)
                                    .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                    .add(jFilename, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 73, Short.MAX_VALUE)
                                    .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 91, Short.MAX_VALUE))
                                .add(layout.createSequentialGroup()
                                    .add(FilterTextField, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 184, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                    .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)))
                            .add(jApplyFilterButton)))
                    .add(layout.createSequentialGroup()
                        .addContainerGap()
                        .add(jNumSelectedLabel)))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layout.createSequentialGroup()
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jFilenameLabel)
                    .add(jFilename)
                    .add(jLabel2))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jApplyFilterButton)
                    .add(jLabel1)
                    .add(FilterTextField, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 245, Short.MAX_VALUE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jNumSelectedLabel))
        );
    }// </editor-fold>//GEN-END:initComponents

   private void jApplyFilterButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jApplyFilterButtonActionPerformed
      String regex = FilterTextField.getText();
      // Replace * with .* ?with .? as it's more common
      // There appears to be a bug where the replacement cant be done inplace
      int idx = regex.indexOf("*", 0);
      System.out.println("Regex=["+regex+"]");
      String test="";
      if (idx !=-1 && regex.indexOf(".*", 0)==-1){
         test=regex.replaceAll("\\*", "\\.\\*");
         regex=test;
      }
      idx = regex.indexOf("?", 0);
      if (idx !=-1 && regex.indexOf(".?", 0)==-1){
         test=regex.replaceAll("\\?", "\\.\\?");
         regex=test;
      }
      FilterTextField.setText(regex);
      try{
         tableModel.applyFilter(regex);
         tableModel.fireTableDataChanged();
      }
      catch(PatternSyntaxException ex){
         // Should complain here'
         //jLabel4.setText(regex+".*"+"will complain");
      }
      updateSelected();
// TODO add your handling code here:
   }//GEN-LAST:event_jApplyFilterButtonActionPerformed

    private void updateSelected() {
        jNumSelectedLabel.setText(tableModel.getNumSelected());
    }

    public void tableChanged(TableModelEvent e) {
        updateSelected();
    }
   
   
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JFormattedTextField FilterTextField;
    private javax.swing.JButton jApplyFilterButton;
    private javax.swing.JLabel jFilename;
    private javax.swing.JLabel jFilenameLabel;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jNumSelectedLabel;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTable jTable1;
    // End of variables declaration//GEN-END:variables
   
    String getFilterString()
    {
        return FilterTextField.getText();
    }
}
