/*
 * Copyright (c)  2005-2008, Stanford University
 * Use of the OpenSim software in source form is permitted provided that the following
 * conditions are met:
 * 	1. The software is used only for non-commercial research and education. It may not
 *     be used in relation to any commercial activity.
 * 	2. The software is not distributed or redistributed.  Software distribution is allowed 
 *     only through https://simtk.org/home/opensim.
 * 	3. Use of the OpenSim software or derivatives must be acknowledged in all publications,
 *      presentations, or documents describing work in which OpenSim or derivatives are used.
 * 	4. Credits to developers may not be removed from executables
 *     created from modifications of the source.
 * 	5. Modifications of source code must retain the above copyright notice, this list of
 *     conditions and the following disclaimer. 
 * 
 *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
 *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 *  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
 *  SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
 *  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 *  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; 
 *  HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 *  OR BUSINESS INTERRUPTION) OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
 *  WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
/*
 * VisibilityJDialog.java
 *
 * Created on June 28, 2006, 4:05 PM
 */

package org.opensim.view;

import java.awt.Color;
import javax.swing.JColorChooser;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;
import org.opensim.modeling.OpenSimObject;
import org.opensim.view.pub.ViewDB;
import vtk.vtkProperty;

/**
 *
 * @author  Ayman
 *
 * @todo replace base class by DialogDescriptor to integrate better into the Windows API of netbeans
 */
public class VisibilityJDialog extends javax.swing.JDialog implements ChangeListener {
    
    OpenSimCanvas   canvas;
    OpenSimObject   object;
    vtkProperty     saveProperty;
    /** Creates new form VisibilityJDialog */
    public VisibilityJDialog(java.awt.Frame parent, 
            OpenSimCanvas canvas, 
            OpenSimObject object) {
        super(parent, false);
        this.object = object;
        this.canvas = canvas;
        initComponents();
        OpacitySlider.addChangeListener(this);
        saveProperty = new vtkProperty();
        ViewDB.getInstance().getObjectProperties(object, saveProperty);
        
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        jPanel1 = new javax.swing.JPanel();
        ObjectNameLabel = new javax.swing.JLabel();
        ObjectNameText = new javax.swing.JTextField();
        OpacityLabel = new javax.swing.JLabel();
        OpacitySlider = new javax.swing.JSlider();
        ColorLabel = new javax.swing.JLabel();
        jChooseColorBtn = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Object Visibility");
        setAlwaysOnTop(true);
        setResizable(false);
        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder("Visible Properties"));
        ObjectNameLabel.setText("Object Name:");

        ObjectNameText.setEditable(false);
        ObjectNameText.setText(object.getName());
        ObjectNameText.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ObjectNameTextActionPerformed(evt);
            }
        });

        OpacityLabel.setText("Opacity:");

        ColorLabel.setText("Color:");

        jChooseColorBtn.setText("Choose...");
        jChooseColorBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jChooseColorBtnActionPerformed(evt);
            }
        });

        org.jdesktop.layout.GroupLayout jPanel1Layout = new org.jdesktop.layout.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                    .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel1Layout.createSequentialGroup()
                        .add(OpacityLabel)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(OpacitySlider, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 96, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                    .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel1Layout.createSequentialGroup()
                        .add(ObjectNameLabel)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(ObjectNameText, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 88, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                .add(1, 1, 1)
                .add(ColorLabel)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jChooseColorBtn)
                .addContainerGap(20, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel1Layout.createSequentialGroup()
                .addContainerGap(29, Short.MAX_VALUE)
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(ObjectNameLabel)
                    .add(ObjectNameText, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                        .add(OpacityLabel)
                        .add(ColorLabel)
                        .add(jChooseColorBtn))
                    .add(OpacitySlider, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(23, 23, 23))
        );

        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
        );
        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jChooseColorBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jChooseColorBtnActionPerformed
// TODO add your handling code here:
        JColorChooser objectColorChooser = new JColorChooser();
        Color newColor = objectColorChooser.showDialog(canvas, "Select new background color", canvas.getBackground());
        if (newColor != null){
             float[] colorComponents = newColor.getRGBComponents(null);
             double[] dColorComponents = new double[]{colorComponents[0], colorComponents[1], colorComponents[2]};
             ViewDB.getInstance().setObjectColor(object, dColorComponents);
        }
    }//GEN-LAST:event_jChooseColorBtnActionPerformed

    private void ObjectNameTextActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ObjectNameTextActionPerformed
// TODO add your handling code here:
    }//GEN-LAST:event_ObjectNameTextActionPerformed
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
    }

    public void stateChanged(ChangeEvent e) {
        // Handle change in opacity slider
        int newOpacity = ((javax.swing.JSlider)e.getSource()).getValue();
        ViewDB.getInstance().setObjectOpacity(object, (double)newOpacity/100.0);
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel ColorLabel;
    private javax.swing.JLabel ObjectNameLabel;
    private javax.swing.JTextField ObjectNameText;
    private javax.swing.JLabel OpacityLabel;
    private javax.swing.JSlider OpacitySlider;
    private javax.swing.JButton jChooseColorBtn;
    private javax.swing.JPanel jPanel1;
    // End of variables declaration//GEN-END:variables
    
}
