<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>OpenSim Documentation : Getting Started with CMC</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            OpenSim Documentation : Getting Started with CMC
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 30, 2012 by <font color="#0050B2">jenhicks</font>.
				    </div>
                    <div class="wiki-content" style="margin-left: 0.0px;"><p>On this page, we provide a conceptual review of the inputs and outputs of the Computed Muscle Control (CMC) tool, along with a set of troubleshooting tips and best practices. CMC is a tool for estimating the muscle excitations that drive a subject's motion and is covered in detail in the sections that follow:</p><p><div>
<ul>
    <li><a href='#GettingStartedwithCMC-SettingsFile'>Settings File</a></li>
    <li><a href='#GettingStartedwithCMC-Inputs'>Inputs</a></li>
    <li><a href='#GettingStartedwithCMC-Outputs'>Outputs</a></li>
    <li><a href='#GettingStartedwithCMC-BestPracticesandTroubleshootingTips'>Best Practices and Troubleshooting Tips</a></li>
</ul></div></p><p> </p><p>The Computed Muscle Control tool is accessed by selecting <strong>Tools → Computed Muscle Control…</strong> from the OpenSim main menu bar. Like all tools, the operations performed by the Computed Muscle Control tool apply to the current model.</p><p>The figure below shows the required inputs and outputs for the Computed Muscle Control Tool. Each is described in more detail in the following sections.</p><div class="panelMacro"><p> </p><div class="table-wrap"><table class="confluenceTable"><colgroup><col /><col /></colgroup><tbody><tr class="confluenceTr"><td class="confluenceTd"><img class="confluence-embedded-image confluence-external-resource" height="16" width="16" src="images/icons/emoticons/information.gif" data-image-src="http://simtk-confluence.stanford.edu:8080/images/icons/emoticons/information.gif"></td><td class="confluenceTd"><span style="color: rgb(0,0,0);">Note: The following file names are examples that can be found in the examples/Gait2354_Simbody directory installed with the OpenSim distribution.</span></td></tr></tbody></table></div><p> </p></div><p><br class="atl-forced-newline" /><img class="confluence-embedded-image confluence-external-resource" height="153" width="546" src="attachments/1443228/1900778.png" data-image-src="http://simtk-confluence.stanford.edu:8080/download/attachments/1443228/worddav990d5f82663d84fe30262838cfc2c8a5.png?version=1&amp;modificationDate=1322501683415"></p><p><strong>Figure</strong><strong>: Inputs and Outputs of the Computed Muscle Control Tool.</strong> Experimental data are shown in <span style="color: rgb(0,204,153);">green</span>; OpenSim files (.osim) are shown in <span style="color: rgb(165,0,33);">red</span>; settings files are shown in<span style="color: rgb(51,102,255);">blue</span>; files generated by the workflow are shown in <span style="color: rgb(153,51,255);">purple</span>.</p><h2 id="GettingStartedwithCMC-SettingsFile">Settings File</h2><p>The <span style="color: rgb(51,102,255);"><strong>subject01_Setup_CMC.xml</strong></span> file is a setup file for the CMC Tool, which specifies settings, inputs, and outputs that affect the behavior of the tracking controller to determine actuator (including muscles) controls. These can be defined using the GUI or by hand. Details of the settings are described in the section on the <a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/Graphical+User+Interface">Graphical User Interface</a>.</p><p>The setup file identifies the actuators (i.e., the residual actuators, such as required for dynamic consistency) as well as the kinematic tracking tasks. Furthermore, control constraints on the actuators (to limit the maximum residual force) can be specified.</p><h2 id="GettingStartedwithCMC-Inputs">Inputs</h2><p>Several data files are required as input by the Computed Muscle Control Tool:</p><p><span style="color: rgb(153,51,255);"><strong>subject01_walk1_RRA_Kinematics_q.sto</strong></span>: Contains the time histories of model kinematics including the joint angles and pelvis translations from RRA.</p><p><span style="color: rgb(51,102,255);"><strong>gait2345_CMC_Tasks.xml</strong></span>: The tracking tasks file specifying which coordinates to track and the corresponding tracking weight (weights are relative and determine how &quot;well&quot; a joint angle will track the specified joint angle from RRA).</p><p><span style="color: rgb(51,102,255);"><strong>gait2345_CMC_ControlConstraints.xml</strong></span>: Contains limits on model actuators, which include muscles, reserve and residual actuators. The control constraints file specifies the maximum and minimum &quot;excitation&quot; (i.e., control signal) for each actuator. Control constraints can also be used to enforce when certain actuators are &quot;on&quot; or &quot;off&quot; and the range in which they can operate.</p><p><span style="color: rgb(0,204,153);"><strong>subject01_walk1_grf.xml</strong></span>: External load data (i.e., ground reaction forces, moments, and center of pressure location). See <a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/Inverse+Dynamics" rel="nofollow">Inverse Dynamics</a> for more details.</p><p><span style="color: rgb(165,0,33);"><strong>subject01_simbody_adjusted .osim</strong></span>: A subject-specific OpenSim model generated by scaling a generic model with the Scale Tool or by other means, along with an associated marker set containing adjusted virtual markers. The model must include inertial parameters. The model should have an adjusted torso center of mass to reduce residuals</p><p><span style="color: rgb(51,102,255);"><strong>gait2345_CMC_Actuators.xml</strong></span>: Contains the residual and reserve actuators, as in RRA.</p><h2 id="GettingStartedwithCMC-Outputs">Outputs</h2><p>The Computed Muscle Control Tool tool primarily reports the necessary controls:</p><p><span style="color: rgb(153,51,255);"><strong>subject01_walk1_controls.xml</strong></span>: Contains the excitations to individual muscles as well as controls for any residual and/or reserve actuators. </p><p><span style="color: rgb(153,51,102);"><strong>subject01_CMC_forces.sto</strong></span>: Muscle forces and reserve/residual forces and torques.</p><p>For completeness, CMC outputs the state trajectories (these are joint coordinate values and their speeds, as well as muscle states such activation and fiber length) :</p><p><span style="color: rgb(153,51,255);"><strong>subject01_walk1_states.sto</strong></span>: Model states and muscle states of the simulated motion (i.e., joint angles AND velocities, muscle fiber lengths AND activations).</p><h2 id="GettingStartedwithCMC-BestPracticesandTroubleshootingTips">Best Practices and Troubleshooting Tips</h2></div><div class="pageSection group"> <ol><li>Compare the simulated activations to experimental EMG data (either recorded from your subject or from the literature). Activations should exhibit similar timing and magnitude to EMG data.</li><li>Peak reserve actuators torques should typically be less than 10% of the peak joint torque.</li><li>If performing Perturbation or Induced Acceleration Analysis, you should verify that reserves and residuals contribute less than 5% to the net acceleration of interest.</li><li>Compare your results (muscle activations or forces) to other simulations, if available.</li><li>To help minimize reserve torques, make an initial pass with default inputs, and then check reserves, residuals, and joint angle errors. To reduce reserves further, decrease tracking weights on coordinates with low error.  </li><li>Optimal forces for reserves should be low to prevent optimizer from &quot;wanting&quot; to use reserve actuators (an actuator with large optimal force and low excitation is &quot;cheap&quot; in the optimizer cost). Increase the maximum control value of residuals so they can generate sufficient force, but are penalized for doing so.</li><li>If CMC is failing, try increasing the max excitation for reserves and residuals by 10x until the simulation runs. Then try working your way back down while also &quot;relaxing&quot; tracking weights on coordinates.</li></ol><p> </p><div class="panel" style="background-color: white;border-color: gray;border-style: solid;border-width: 5px;"><div class="panelContent" style="background-color: white;">
<p>Next: <a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/How+CMC+Works">How CMC Works</a></p><p>Home: <a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/Computed+Muscle+Control">Computed Muscle Control</a></p>
</div></div></div>
				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://simtk-confluence.stanford.edu:8080/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Feb 02, 2012 10:52</font></td>
		    </tr>
	    </table>
    </body>
</html>
