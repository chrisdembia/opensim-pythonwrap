<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>OpenSim Documentation : Getting Started with Scaling</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            OpenSim Documentation : Getting Started with Scaling
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 30, 2012 by <font color="#0050B2">jenhicks</font>.
				    </div>
                    <div class="wiki-content" style="margin-left: 0.0px;"><p>The Scale Tool is accessed by selecting <strong>Tools → Scale Model…</strong> from the OpenSim main menu bar. Like all tools, the operations performed by the Scale Tool apply to the current model</p><p> </p><div><ul><li><a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/Scaling#Scaling-Overview" rel="nofollow">Overview</a></li><li><a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/Scaling#Scaling-SettingsFiles" rel="nofollow">Settings Files</a></li><li><a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/Scaling#Scaling-Inputs" rel="nofollow">Inputs</a></li><li><a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/Scaling#Scaling-Outputs" rel="nofollow">Outputs</a></li><li><a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/Scaling#Scaling-BestPracticesandTroubleshooting" rel="nofollow">Best Practices and Troubleshooting</a></li></ul></div><p> </p><h2 id="GettingStartedwithScaling-Overview">Overview</h2><p>The figure below shows the required inputs and outputs for the Scale Tool. Each is described in more detail in the following sections.</p><div class="panelMacro"><p> </p><div class="table-wrap"><table class="confluenceTable"><colgroup><col /><col /></colgroup><tbody><tr class="confluenceTr"><td class="confluenceTd"><img class="confluence-embedded-image confluence-external-resource" height="16" width="16" src="images/icons/emoticons/information.gif" data-image-src="http://simtk-confluence.stanford.edu:8080/images/icons/emoticons/information.gif"></td><td class="confluenceTd">Note: The following file names are examples that can be found in the examples/Gait2354_Simbody directory installed with the OpenSim distribution.</td></tr></tbody></table></div><p> </p></div><p><img class="confluence-embedded-image confluence-external-resource" height="152" width="453" src="attachments/1443165/1900726.png" data-image-src="http://simtk-confluence.stanford.edu:8080/download/attachments/1443165/worddavbb7c9d35b2e019ed7e7a44a2b993bb76.png?version=1&amp;modificationDate=1322090360241"></p><p><strong>Figure</strong><strong>: Inputs and Outputs of the Scale Tool.</strong> Experimental data are shown in <span style="color: rgb(0,128,0);">green</span>; OpenSim files (.osim) are shown in <span style="color: rgb(128,0,128);">red</span>; settings files are shown in <span style="color: rgb(0,0,255);">blue</span>.</p><h2 id="GettingStartedwithScaling-SettingsFiles">Settings Files</h2><p>The <span style="color: rgb(0,0,255);">subject01_Setup_Scale.xml</span> file is the setup file for the Scale Tool. It contains settings, described in detail in <a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/How+Scaling+Works">How Scaling Works</a>, and refers to other files that contain additional settings. These other files are listed below:</p><p><span style="color: rgb(0,0,255);"><strong>gait2354_Scale_MarkerSet.xml</strong></span>: Marker set for the Scale Tool. It contains the set of virtual markers that are placed on the body segments of the model.</p><p><span style="color: rgb(0,0,255);"><strong>gait2354_Scale_Tasks.xml</strong></span>: Inverse kinematics tasks for the Scale Tool. In addition to scaling the model, the Scale Tool moves the virtual markers on the model so that their positions match the experimental marker locations. To do this, the Scale Tool must position the model so that it best matches the position of the subject. This requires an inverse kinematics problem to be solved. This file contains the inverse kinematics tasks (i.e., a specification of which virtual and experimental markers should be matched up during the inverse kinematics solution) and their relative weightings. This file contains the inverse kinematics tasks describing which virtual and experimental markers should be matched up during the inverse kinematics phase. The file also contains marker weights, which are relative and determine how &quot;well&quot; the virtual markers track experimental markers (i.e., a larger weight will mean less error between virtual and experimental marker positions).</p><p><span style="color: rgb(0,0,255);"><strong>gait2354_Scale_MeasurementSet.xml</strong></span>: Measurement set for the Scale Tool. It contains pairs of experimental markers, the distance between which are used to scale the generic musculoskeletal model. </p><p>AND/OR</p><p><span style="color: rgb(0,0,255);"><strong>subject01_Scale_ScaleSet.xml</strong></span>: Scale set for the Scale Tool. It contains a set of manual scale factors to be applied to the generic musculoskeletal model.</p><h2 id="GettingStartedwithScaling-Inputs">Inputs</h2><p>Two data files are required by the Scale Tool:</p><p><span style="color: rgb(0,128,0);"><strong>subject01_static.trc</strong></span>: Experimental marker trajectories for a static trial. A static trial is usually several seconds of data with the subject posed in a known static position. A segment of a regular motion file can be used as a static trial if desired, but this is not typically done. The static pose should include the subject wearing the full marker set. The marker trajectories are specified in global frame. </p><p><span style="color: rgb(128,0,128);"><strong>gait2354_simbody.osim</strong></span>: OpenSim musculoskeletal model. This generic model will be scaled to match the anthropometry of your subject.</p><p>You can also provide an additional, optional file:</p><p><span style="color: rgb(0,0,255);"><strong><span style="color: rgb(128,0,128);">subject01_static.mo</span></strong>t</span>: Experimental generalized coordinate values (joint angles) for a trial obtained from alternative motion capture devices or other specialized algorithms. You can specify coordinate weights in the Tasks file, if joint angles are know a priori. Coordinate weights are also relative and determine how &quot;well&quot; a joint angle will track the specified angle.</p><h2 id="GettingStartedwithScaling-Outputs">Outputs</h2><p>The Scale Tool generates a single file:</p><p><span style="color: rgb(128,0,128);"><strong>subject01_simbody.osim</strong></span>: OpenSim musculoskeletal model scaled to the dimensions of the subject.</p><h2 id="GettingStartedwithScaling-BestPracticesandTroubleshooting">Best Practices and Troubleshooting</h2><p><h4 id="GettingStartedwithScaling-DataCollectionandOtherPreparation">Data Collection and Other Preparation:</h4><ol><li>When collecting data, take pictures of your subjects in the static pose. These picture are valuable for evaluating the results of the Scale tool</li><li>Measure subject specifics, like height, mass, body segment lengths, mass distribution (if DXA is available), and strength (if a Biodex is available). You can use this data, along with marker positions, to best match the generic model to a specific subject.</li><li>Have your subjects perform movements to calculate functional joint centers at the hip, knee, ankle, and/or shoulders and append the joint centers to your static trial data. (Refs? More info about how to do this?)</li></ol><h4 id="GettingStartedwithScaling-ScaleSettings">Scale Settings:</h4><ol><li>Rely on markers that correspond to anatomical landmarks and functional joint centers (FJC) to position and scale the generic model. (More info about specific settings, higher weightings)</li><li>Some segments, like the pelvis are best scaled non-uniformly. Why? How?</li><li>How should you set the time frame?</li><li>Use of mass, body segment lengths, etc.</li><li>Use of coords you've collected?</li></ol><h4 id="GettingStartedwithScaling-EvaluatingyourResults">Evaluating your Results:</h4><ol><li>Scaling a model is an iterative process. Use the &quot;preview static pose&quot; option in the GUI. This does the following . . . After running preview, perform steps X to X described below.</li><li>Check the messages window, which has information about the results of scaling, including the overal RMS marker error and the maximum marker error. <ol><li>In general, maximum marker errors for bony landmarks should be &lt;2 cm.  </li><li>What about RMS error?</li><li>Pay close attention to errors in the landmark and FJC markers when assessing the quality of your scaling results.</li></ol></li><li>Visualize the scaled model's anatomical marker positions relative to the corresponding experimental markers to see how well the model &quot;fits&quot; the data. Use the pictures you took to assess the results, comparing the joint angles in the &quot;Coordinates&quot; window to the angles you observe in the pictures.<ol><li>Do the hip, knee, and ankle angles from scale match what you observe in the picture?</li><li>Anything about marker placement? </li><li>If pictures aren't available, use what you know about a typical static pose capture. For example, the ankle angle is generally less than 5º and hip flexion angle is less than 10º.</li><li>Again, pay close attention to errors in the landmark and FJC markers when assessing the quality of your scaling results.</li></ol></li><li>After examining the messages window and performing a visual comparison, adjust the virtual markers and marker weightings to improve your results:<ol><li>Avoid adjusting the positions of the landmark and FJC virtual markers to match the experimental markers. </li></ol></li><li>Once you've adjusted the virtual marker positions and the scale settings preview the new static pose. Re-assess your results using steps X to X about. Once you are happy with your results, hit &quot;Run&quot; to generate a scaled model and adjust the virtual markers on the model to match all of the experimental markers.</li></ol><h4 id="GettingStartedwithScaling-TroubleshootingTips">Troubleshooting Tips:</h4><ol><li>It is common to iterate through Scale and Inverse Kinematics to fine-tune segment dimensions and marker positions that yield low marker errors for the task of interest.</li><li>Use coordinate tasks (Static Pose Weights) to set joint angles for troublesome joints that are very sensitive to how the markers are placed (commonly the ankle joint and lumbar joint). For example if it is known that the foot is flat, an ankle angle can be provided and then the markers adjusted in order to match the known pose.</li><li>If using coordinates from a motion capture system make sure that the joint/coordinate definitions match otherwise you may cause more harm than good. How to check?</li><li>The model has a built in assumption that the global Y axis is up. If your data doesn't fit this, then consider transforming it using the Preview Motion Data option in the GUI.</li></ol></p></div><div class="pageSection group"><div class="panel" style="background-color: white;border-color: gray;border-style: solid;border-width: 5px;"><div class="panelContent" style="background-color: white;">
<p>Next: <a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/How+Scaling+Works">How Scaling Works</a></p><p>Home: <a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/Scaling">Scaling</a></p>
</div></div></div>
				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://simtk-confluence.stanford.edu:8080/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Feb 02, 2012 10:52</font></td>
		    </tr>
	    </table>
    </body>
</html>
