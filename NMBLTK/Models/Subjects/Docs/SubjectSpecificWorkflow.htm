<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 9">
<meta name=Originator content="Microsoft Word 9">
<link rel=File-List href="./SubjectSpecificWorkflow_files/filelist.xml">
<title>Steps to prepare a new subject model (xxx is to be replaced with actual
name s26, n187):</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Ayman Habib</o:Author>
  <o:LastAuthor>Frank C. Anderson</o:LastAuthor>
  <o:Revision>8</o:Revision>
  <o:TotalTime>5073</o:TotalTime>
  <o:LastPrinted>2005-01-25T20:03:00Z</o:LastPrinted>
  <o:Created>2005-02-01T23:18:00Z</o:Created>
  <o:LastSaved>2005-05-31T22:07:00Z</o:LastSaved>
  <o:Pages>2</o:Pages>
  <o:Words>1319</o:Words>
  <o:Characters>7519</o:Characters>
  <o:Company>Stanford University</o:Company>
  <o:Lines>62</o:Lines>
  <o:Paragraphs>15</o:Paragraphs>
  <o:CharactersWithSpaces>9233</o:CharactersWithSpaces>
  <o:Version>9.6926</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>150</w:Zoom>
  <w:PunctuationKerning/>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
  <w:DontDisplayPageBoundaries/>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
h3
	{mso-style-link:"Heading 3 Char";}
span.HEADING3CHAR
	{mso-style-locked:yes;
	mso-style-link:"Heading 3";}
span.SPELLE
	{mso-spl-e:yes;}
span.GRAME
	{mso-gram-e:yes;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	mso-style-next:"Heading 3";
	margin:0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0pt;
	margin-bottom:3.0pt;
	margin-left:0pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:16.0pt;
	font-family:Arial;
	mso-font-kerning:16.0pt;}
h2
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0pt;
	margin-bottom:3.0pt;
	margin-left:0pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:2;
	font-size:14.0pt;
	font-family:Arial;
	font-style:italic;}
h3
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0pt;
	margin-bottom:3.0pt;
	margin-left:0pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:13.0pt;
	font-family:Arial;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-ansi-font-size:13.0pt;
	mso-bidi-font-size:13.0pt;
	mso-ascii-font-family:Arial;
	mso-hansi-font-family:Arial;
	mso-bidi-font-family:Arial;
	mso-ansi-language:EN-US;
	mso-fareast-language:EN-US;
	mso-bidi-language:AR-SA;
	font-weight:bold;}
@page Section1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	mso-header-margin:36.0pt;
	mso-footer-margin:36.0pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
@list l0
	{mso-list-id:20403651;
	mso-list-type:hybrid;
	mso-list-template-ids:-670151368 67698703 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l0:level1
	{mso-level-tab-stop:90.0pt;
	mso-level-number-position:left;
	margin-left:90.0pt;
	text-indent:-18.0pt;}
@list l0:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:126.0pt;
	mso-level-number-position:left;
	margin-left:126.0pt;
	text-indent:-18.0pt;
	font-family:"Courier New";}
@list l1
	{mso-list-id:110168980;
	mso-list-type:hybrid;
	mso-list-template-ids:-517686716 67698703 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l1:level1
	{mso-level-tab-stop:90.0pt;
	mso-level-number-position:left;
	margin-left:90.0pt;
	text-indent:-18.0pt;}
@list l1:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:126.0pt;
	mso-level-number-position:left;
	margin-left:126.0pt;
	text-indent:-18.0pt;
	font-family:"Courier New";}
@list l2
	{mso-list-id:174809023;
	mso-list-type:hybrid;
	mso-list-template-ids:-2066318190 67698703 67698691 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l2:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:"Courier New";}
@list l3
	{mso-list-id:1030881800;
	mso-list-type:hybrid;
	mso-list-template-ids:1805814970 67698691 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l3:level1
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	margin-left:72.0pt;
	text-indent:-18.0pt;
	font-family:"Courier New";}
@list l3:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	margin-left:108.0pt;
	text-indent:-18.0pt;
	font-family:"Courier New";}
@list l4
	{mso-list-id:1280720734;
	mso-list-type:hybrid;
	mso-list-template-ids:-1867980584 67698703 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l4:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:"Courier New";}
@list l5
	{mso-list-id:1317145132;
	mso-list-type:hybrid;
	mso-list-template-ids:-1250647726 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l5:level2
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
ol
	{margin-bottom:0pt;}
ul
	{margin-bottom:0pt;}
-->
</style>
<!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">  </w:LatentStyles>
</xml><![endif]-->
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:36.0pt'>

<div class=Section1>

<h1>Subject specific simulation workflow</h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>This document is intended as a documentation of the steps
that need to be taken by researchers trying to create and analyze subject
specific simulations. The document is a work in progress and should be amended
whenever new info that helps customize/improve the workflow becomes available.</p>

<p class=MsoNormal>&nbsp;</p>

<h3><a name="_Workflow_outline"></a>Workflow outline</h3>

<ol style='margin-top:0pt' start=1 type=1>
 <li class=MsoNormal style='mso-list:l4 level1 lfo3;tab-stops:list 36.0pt'>Subject
     specific motion capture data is obtained from one of the collaborating
     hospitals/centers and preprocessed to match the assumptions in the
     workflow, this preprocessing is not yet covered in this document. </li>
 <li class=MsoNormal style='mso-list:l4 level1 lfo3;tab-stops:list 36.0pt'>Motion
     capture data is used to scale a standard nominal model (that has been
     tested and validated) to match the size of the subject. We’ll call it
     subject-model. (<a href="#runDarrylsScripts">step</a>)</li>
 <li class=MsoNormal style='mso-list:l4 level1 lfo3;tab-stops:list 36.0pt'>Inverse
     kinematics is used to calculate joint kinematics that best reproduce
     experimental data using the subject-model. This is done by minimizing the
     weighted sum of errors in a set of markers for each frame of the motion. (<a
     href="#runDarrylsScripts">step</a>)</li>
 <li class=MsoNormal style='mso-list:l4 level1 lfo3;tab-stops:list 36.0pt'>The
     motion that results from inverse kinematics will generally be not
     dynamically consistent with measured ground reaction forces, REA (Residual
     Elimination Algorithm) is performed on the motion resulting from inverse
     kinematics to adjust few generalized coordinates (back angles and pelvis
     translations) to make the motion dynamically consistent with measured
     ground reaction forces. (<a href="#runDarrylsScripts">step</a>)</li>
 <li class=MsoNormal style='mso-list:l4 level1 lfo3;tab-stops:list 36.0pt'>With
     dynamically consistent motion and ground reaction forces, computed muscle
     control (CMC) is used to compute muscle excitations to drive the model
     through the motion. The output of CMC is a SIMM motion file that contains
     a set of muscle excitations. (<a href="#runDarrylsScripts">step</a>)</li>
 <li class=MsoNormal style='mso-list:l4 level1 lfo3;tab-stops:list 36.0pt'>An
     open loop forward simulation is performed using the subject-model, muscle
     excitations from previous step. Analyses can be attached to the forward
     simulation to record quantities of interest. (<a href="#runAndAnalyze">step</a>)</li>
</ol>

<h3>Prerequisites</h3>

<ol style='margin-top:0pt' start=1 type=1>
 <li class=MsoNormal style='mso-list:l2 level1 lfo6;tab-stops:list 36.0pt'>You
     have to have the RDI platform installed which includes:</li>
 <ul style='margin-top:0pt' type=circle>
  <li class=MsoNormal style='mso-list:l2 level2 lfo6;tab-stops:list 72.0pt'>Cygwin
      (modules: cvs, perl )</li>
  <li class=MsoNormal style='mso-list:l2 level2 lfo6;tab-stops:list 72.0pt'>Microsoft
      Developer Studio (version 7.1 or version 6.0).</li>
  <li class=MsoNormal style='mso-list:l2 level2 lfo6;tab-stops:list 72.0pt'>RDI
      source code repository (directory /Source/RD).</li>
  <li class=MsoNormal style='mso-list:l2 level2 lfo6;tab-stops:list 72.0pt'>Nmbl
      source code repository (directory /Source/SU)</li>
  <li class=MsoNormal style='mso-list:l2 level2 lfo6;tab-stops:list 72.0pt'>Environment
      variables are set properly per the RDI installation, in particular.</li>
  <ol style='margin-top:0pt' start=1 type=1>
   <li class=MsoNormal style='mso-list:l2 level3 lfo6;tab-stops:list 108.0pt'>RDI_DEV=source
       code repository root directory, </li>
   <li class=MsoNormal style='mso-list:l2 level3 lfo6;tab-stops:list 108.0pt'>RDI_INSTALL=Root
       directory for RDI install on your machine, </li>
   <li class=MsoNormal style='mso-list:l2 level3 lfo6;tab-stops:list 108.0pt'>ARCH=VC71
       or VC6 (depending on your DevStudio version).</li>
  </ol>
 </ul>
 <li class=MsoNormal style='mso-list:l2 level1 lfo6;tab-stops:list 36.0pt'>Build
     the following libraries, or get them from the RDI distribution (If you get
     ready made libraries make sure they correspond to your DevStudio version).
     Place the libraries under $LibDev/VC71D/ ($LibDev/VC6D/) for version 7.1
     (6). Prebuilt libraries for both VC71 and VC6 will be made available under
     $RDI_INSTALL/Lib/$ARCH</li>
</ol>

<h3>&nbsp;<o:p></o:p></h3>

<table border=1 cellspacing=0 cellpadding=0 style='margin-left:53.6pt;
 border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;
 mso-padding-alt:0pt 5.4pt 0pt 5.4pt;mso-yfti-tbllook:480;mso-border-insideh:.5pt solid windowtext;
 mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td width=156 valign=top style='width:117.0pt;border:solid windowtext .5pt;
  padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><i style='mso-bidi-font-style:normal'><span
  style='font-size:9.0pt'>Library name<o:p></o:p></span></i></p>
  </td>
  <td width=192 valign=top style='width:144.0pt;border:solid windowtext .5pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><i style='mso-bidi-font-style:normal'><span
  style='font-size:9.0pt'>DevStudio Project<o:p></o:p></span></i></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td width=156 valign=top style='width:117.0pt;border:solid windowtext .5pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>rdTools_D.lib<o:p></o:p></span></p>
  </td>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext .5pt;border-right:solid windowtext .5pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>RDLibraries/rdTools<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2'>
  <td width=156 valign=top style='width:117.0pt;border:solid windowtext .5pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>rdSimulation_D.lib<o:p></o:p></span></p>
  </td>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext .5pt;border-right:solid windowtext .5pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>RDLibraries/rdSimulation<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3'>
  <td width=156 valign=top style='width:117.0pt;border:solid windowtext .5pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>rdSDFast_D.lib<o:p></o:p></span></p>
  </td>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext .5pt;border-right:solid windowtext .5pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>RDLibraries/rdSDFast<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:4'>
  <td width=156 valign=top style='width:117.0pt;border:solid windowtext .5pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>suPipeline40_D.lib<o:p></o:p></span></p>
  </td>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext .5pt;border-right:solid windowtext .5pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>SULibraries/suPipeline40<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:5'>
  <td width=156 valign=top style='width:117.0pt;border:solid windowtext .5pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>suPipeline40Workflow_D.lib<o:p></o:p></span></p>
  </td>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext .5pt;border-right:solid windowtext .5pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>SULibraries/suPipeline40Workflow<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:6'>
  <td width=156 valign=top style='width:117.0pt;border:solid windowtext .5pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>suAnalyses_D.lib<o:p></o:p></span></p>
  </td>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext .5pt;border-right:solid windowtext .5pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>SULibraries/suAnalyses<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:7;mso-yfti-lastrow:yes'>
  <td width=156 valign=top style='width:117.0pt;border:solid windowtext .5pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>Acpp_D.lib<o:p></o:p></span></p>
  </td>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext .5pt;border-right:solid windowtext .5pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  padding:0pt 5.4pt 0pt 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>$RDI_INSTALL/Lib/$Arch<o:p></o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal><span class=Heading3Char><span style='font-size:13.0pt;
font-family:Arial'>Directory structure &amp; file descriptions</span></span></p>

<p class=MsoNormal>Users can create arbitrary directories to contain subject
specific data files and executables. No assumptions are made about where this
directory is located. Darryl’s code generates a directory for every subject
that contains data files under the name data/xxx where xxx is the name of the
subject. We’ll call this directory <i style='mso-bidi-font-style:normal'>SubjectDirectory</i>.
The subject directory will contain files generated by the preprocessing steps
of Darryl as well as the files created by SIMM and SDFast. Only a few of these
files are relevant to creating and running forward simulations. A brief
description of these relevant files follows:</p>

<p class=MsoNormal style='margin-left:72.0pt;text-indent:-18.0pt;mso-list:l3 level1 lfo8;
tab-stops:list 72.0pt'><![if !supportLists]><span style='font-family:"Courier New"'>o<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>Source code files:</p>

<p class=MsoNormal style='margin-left:90.0pt;text-indent:-18.0pt;mso-list:l0 level1 lfo10;
tab-stops:list 90.0pt'><![if !supportLists]>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>suxxx.cpp, suxxx.h (Created by the script in <a
href="#runMakeprojectScript">step</a>.<span style="mso-spacerun: yes"> 
</span>File usage: wrapper to make the model into a c++ class to be used for
simulation in RDI platform).</p>

<p class=MsoNormal style='margin-left:90.0pt;text-indent:-18.0pt;mso-list:l0 level1 lfo10;
tab-stops:list 90.0pt'><![if !supportLists]>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>suxxx_Forward.cpp (Created by the script in <a
href="#runMakeprojectScript">step</a>. File usage: driver for the forward
simulation that instantiates the model, controls, analyses and runs the
simulation).</p>

<p class=MsoNormal style='margin-left:90.0pt;text-indent:-18.0pt;mso-list:l0 level1 lfo10;
tab-stops:list 90.0pt'><![if !supportLists]>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>sdufuncs_darryl.c (Created by the script in <a
href="#runMakeprojectScript">step</a>. File usage: collection of functions used
to initialize sdfast and functions to be called by sdfast for calculation of
derivatives, constraints, forces,.. It includes changes made by Darryl. This
file is not subject specific but left at this level for potential
modification).</p>

<p class=MsoNormal style='margin-left:90.0pt;text-indent:-18.0pt;mso-list:l0 level1 lfo10;
tab-stops:list 90.0pt'><![if !supportLists]>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>sdfor.c, (Created by SIMM in <a href="#generateDyn">step</a>).</p>

<p class=MsoNormal style='margin-left:90.0pt;text-indent:-18.0pt;mso-list:l0 level1 lfo10;
tab-stops:list 90.0pt'><![if !supportLists]>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>xxx_dyn.c, xxx_sar.c (Created in <a href="#runSDFast">step</a>
by sdfast based on the system description file model.sd generated by SIMM in <a
href="#generateDyn">step</a>. File usage: along with sdfor.c these three files
describe the dynamic behavior of the model and implement the equations of
motion specific to the subject).</p>

<p class=MsoNormal style='margin-left:72.0pt;text-indent:-18.0pt;mso-list:l3 level1 lfo8;
tab-stops:list 72.0pt'><![if !supportLists]><span style='font-family:"Courier New"'>o<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>Data files:</p>

<p class=MsoNormal style='margin-left:90.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo12;
tab-stops:list 90.0pt'><![if !supportLists]>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>xxx.jnt, xxx.msl (SIMM joint and muscle files created in <a
href="#runDarrylsScripts">step</a>).</p>

<p class=MsoNormal style='margin-left:90.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo12;
tab-stops:list 90.0pt'><![if !supportLists]>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>xxxcmc.mot (motion file output of cmc, including muscle
excitations computed in <a href="#runDarrylsScripts">step</a>).</p>

<p class=MsoNormal style='margin-left:90.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo12;
tab-stops:list 90.0pt'><![if !supportLists]>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>xxxcmc.ctr (muscle excitations extracted from xxxcmc.mot in
xml format. This file is created in <a href="#extractControls">step</a>).</p>

<p class=MsoNormal style='margin-left:90.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo12;
tab-stops:list 90.0pt'><![if !supportLists]>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>params.txt (parameters used to initialize the model including
muscle file name, and motion file to initialize positions, velocities and
accelerations. Created by SIMM in <a href="#generateDyn">step</a>).</p>

<p class=MsoNormal style='margin-left:72.0pt;text-indent:-18.0pt;mso-list:l3 level1 lfo8;
tab-stops:list 72.0pt'><![if !supportLists]><span style='font-family:"Courier New"'>o<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>Support files to build the executables needed to
execute all the steps: (*.sln *.vcproj, *.dsp, *.dsw)</p>

<h2>Steps: </h2>

<p class=MsoNormal>In the following steps, “xxx” should be replaced with an
actual subject name (e.g. s26, n187). Names are case sensitive, use small
letters when prompted for model name. Model names can include underscores and
have no length restrictions so you can use n123_05 for version 5 of the model
for subject n123, you just need to make sure that the muscle, joint and control
files all observe the same naming. </p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Item 1 in the <a href="#_Workflow_outline">workflow outline</a>
(preprocessing) is not accounted for in these steps. Items 2-5 of the outline
are done using Darryl’s provided scripts. Customization and tuning of these
scripts is still underway. The steps below target item 6 of the workflow
outline (running and analyzing a forward simulation of the subject model). To
build and run the executable that simulates the subject model we need to:</p>

<p class=MsoNormal style='margin-left:72.0pt;text-indent:-18.0pt;mso-list:l3 level1 lfo8;
tab-stops:list 72.0pt'><![if !supportLists]><span style='font-family:"Courier New"'>o<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>Setup input files for simulation (Steps 1, 3 below)</p>

<p class=MsoNormal style='margin-left:72.0pt;text-indent:-18.0pt;mso-list:l3 level1 lfo8;
tab-stops:list 72.0pt'><![if !supportLists]><span style='font-family:"Courier New"'>o<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>Generate equations of motion for the subject from SIMM
model. (Steps 4-6)</p>

<p class=MsoNormal style='margin-left:72.0pt;text-indent:-18.0pt;mso-list:l3 level1 lfo8;
tab-stops:list 72.0pt'><![if !supportLists]><span style='font-family:"Courier New"'>o<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>Wrap equations of motion into C++ class. (Automated in
Step 2)</p>

<p class=MsoNormal style='margin-left:72.0pt;text-indent:-18.0pt;mso-list:l3 level1 lfo8;
tab-stops:list 72.0pt'><![if !supportLists]><span style='font-family:"Courier New"'>o<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>Properly initialize the model (Step 7)</p>

<p class=MsoNormal style='margin-left:72.0pt;text-indent:-18.0pt;mso-list:l3 level1 lfo8;
tab-stops:list 72.0pt'><![if !supportLists]><span style='font-family:"Courier New"'>o<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>Write main program to instantiate the model, launch
simulation and add analyses to it. (Automated in Step 2)</p>

<p class=MsoNormal style='margin-left:72.0pt;text-indent:-18.0pt;mso-list:l3 level1 lfo8;
tab-stops:list 72.0pt'><![if !supportLists]><span style='font-family:"Courier New"'>o<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>Build and run the simulation (Steps 8-9).</p>

<h3><span style='font-size:12.0pt;font-family:"Times New Roman";mso-bidi-font-family:
Arial;font-weight:normal'>The rest of the steps move files around to have them
in the proper directory for simulation.<o:p></o:p></span></h3>

<ol style='margin-top:0pt' start=1 type=1>
 <li class=MsoNormal style='mso-list:l5 level1 lfo15;tab-stops:list 36.0pt'><a
     name=runDarrylsScripts>Run Darryl’s scripts </a>to create subject
     directory (xxx) and create the files xxx.jnt, xxx.msl, xxxcmc.mot in it.</li>
 <li class=MsoNormal style='mso-list:l5 level1 lfo15;tab-stops:list 36.0pt'><a
     name=runMakeprojectScript>Change to subject directory (xxx) and run the
     script</a> makeProject.pl from repository using command: <b
     style='mso-bidi-font-weight:normal'><i style='mso-bidi-font-style:normal'>perl
     $RDI_INSTALL/Bin/makeProject.pl</i></b>. This adds the following source
     files to the subject directory (suxxx.cpp, suxxx.h, suxxx_Forward.cpp,
     sdufuncs_darryl.c). It also creates Microsoft project files to build the
     forward simulation executable (suxxx.sln &amp; suxxx.vcproj) for version
     7.1 (suxxx.dsw/ suxxx.dsp for version 6).</li>
 <li class=MsoNormal style='mso-list:l5 level1 lfo15;tab-stops:list 36.0pt'><a
     name=extractControls>Run the executable </a>that extracts controls from
     the xxxcmc.mot file in the subject directory as follows: <b
     style='mso-bidi-font-weight:normal'><i style='mso-bidi-font-style:normal'>$RDI_INSTALL/Bin/convertStorageToControls_VC71D.exe
     xxxcmc.mot glut_med1_r_exc 92 xxxcmc.ctr. </i></b>This will generate a
     file of muscle excitations xxxcmc.ctr in the subject directory. You can
     also use pre-built executable from
     ($RDI_INSTALL/Bin/$Arch/rdConvertStorageToControls_D.exe) instead.</li>
 <li class=MsoNormal style='mso-list:l5 level1 lfo15;tab-stops:list 36.0pt'><a
     name=generateDyn>Start SIMM4.0 and </a>open the files xxx.jnt &amp;
     xxx.msl from step 1. (Some bone files may be missing though this does not
     affect results).</li>
 <li class=MsoNormal style='mso-list:l5 level1 lfo15;tab-stops:list 36.0pt'>Select
     File/SaveDynamics and check all checkboxes, save to the default xxx
     directory. This generates a lot of files and directories needed to run the
     simulation in SIMM but these are not relevant for the workflow except for
     (params.txt, dynsim/src/model.sd and dynsim/src/sdfor.c)</li>
 <li class=MsoNormal style='mso-list:l5 level1 lfo15;tab-stops:list 36.0pt'><a
     name=runSDFast>Run sdfast </a>(on Hill) on the input file
     dynsim/src/model.sd to generate files xxx_dyn.c, xxx_sar.c and copy them
     back to the subject directory (xxx). </li>
 <li class=MsoNormal style='mso-list:l5 level1 lfo15;tab-stops:list 36.0pt'><a
     name=buildsimulator>Add the line “kinetics_file xxxcmc.mot” to the file
     params.txt created by SIMM in step 5 (at line 16 of the file).</a></li>
 <li class=MsoNormal style='mso-list:l5 level1 lfo15;tab-stops:list 36.0pt'><span
     style='mso-bookmark:buildsimulator'>Build the executable </span>using <b
     style='mso-bidi-font-weight:normal'><i style='mso-bidi-font-style:normal'>devenv
     suxxx.sln /build Debug /project suxxx.vcproj</i> </b>in the subject directory,
     this creates an executable suxxx.exe. (for vc6.0 use ?? instead).</li>
 <li class=MsoNormal style='mso-list:l5 level1 lfo15;tab-stops:list 36.0pt'><a
     name=runAndAnalyze>Run the executable </a>generated in previous step in
     the subject directory. Analysis results are stored under the Results
     subdirectory. You can view the motion in SIMM4 by changing the extension
     of the file Results/xxx_Kinematics_q.sto to .mot and open it in SIMM.</li>
</ol>

<p class=MsoNormal>&nbsp;</p>

</div>

</body>

</html>
